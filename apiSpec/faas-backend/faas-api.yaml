openapi: 3.1.0
info:
  title: FaaS Backend API
  description: Function as a Service Backend API for Softbank Hackathon
  version: 1.0.0
paths:
  /api/workspaces:
    get:
      tags:
      - Workspaces
      summary: List Workspaces
      description: ''
      operationId: list_workspaces_api_workspaces_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Workspace'
                type: array
                title: Response List Workspaces Api Workspaces Get
    post:
      tags:
      - Workspaces
      summary: Create Workspace
      description: ''
      operationId: create_workspace_api_workspaces_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceCreate'
        required: true
      responses:
        '201':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/workspaces/{workspace_id}:
    get:
      tags:
      - Workspaces
      summary: Get Workspace
      description: ''
      operationId: get_workspace_api_workspaces__workspace_id__get
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    patch:
      tags:
      - Workspaces
      summary: Update Workspace
      description: ''
      operationId: update_workspace_api_workspaces__workspace_id__patch
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceUpdate'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      tags:
      - Workspaces
      summary: Delete Workspace
      description: ''
      operationId: delete_workspace_api_workspaces__workspace_id__delete
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      responses:
        '204':
          description: Successful Response
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/workspaces/{workspace_id}/functions:
    post:
      tags:
      - Functions
      summary: Create Function
      description: ''
      operationId: create_function_api_workspaces__workspace_id__functions_post
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FunctionCreate'
      responses:
        '201':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FunctionConfig'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    get:
      tags:
      - Functions
      summary: List Functions
      description: ''
      operationId: list_functions_api_workspaces__workspace_id__functions_get
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FunctionConfig'
                title: Response List Functions Api Workspaces  Workspace Id  Functions
                  Get
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/workspaces/{workspace_id}/functions/{function_id}:
    get:
      tags:
      - Functions
      summary: Get Function
      description: ''
      operationId: get_function_api_workspaces__workspace_id__functions__function_id__get
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      - name: function_id
        in: path
        required: true
        schema:
          type: string
          title: Function Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FunctionConfig'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    patch:
      tags:
      - Functions
      summary: Update Function
      description: ''
      operationId: update_function_api_workspaces__workspace_id__functions__function_id__patch
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      - name: function_id
        in: path
        required: true
        schema:
          type: string
          title: Function Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FunctionUpdate'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FunctionConfig'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
    delete:
      tags:
      - Functions
      summary: Delete Function
      description: ''
      operationId: delete_function_api_workspaces__workspace_id__functions__function_id__delete
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      - name: function_id
        in: path
        required: true
        schema:
          type: string
          title: Function Id
      responses:
        '204':
          description: Successful Response
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/workspaces/{workspace_id}/functions/{function_id}/logs:
    get:
      tags:
      - Logs
      summary: Get Function Logs
      description: ''
      operationId: get_function_logs_api_workspaces__workspace_id__functions__function_id__logs_get
      parameters:
      - name: workspace_id
        in: path
        required: true
        schema:
          type: string
          title: Workspace Id
      - name: function_id
        in: path
        required: true
        schema:
          type: string
          title: Function Id
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 1000
          minimum: 1
          default: 100
          title: Limit
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogsResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/build:
    post:
      tags:
      - Builds
      summary: Build
      description: '- **file**: .py   .zip  ()

        - **app_name**:   (,   )

        - **workspace_id**:  ID (: ws-default)'
      operationId: build_api_v1_build_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Body_build_api_v1_build_post'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BuildResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/tasks/{task_id}:
    get:
      tags:
      - Builds
      summary: Get Task Status
      description: '- **task_id**:  ID'
      operationId: get_task_status_api_v1_tasks__task_id__get
      parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
          title: Task Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskStatusResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/push:
    post:
      tags:
      - Builds
      summary: Push To Ecr
      description: "ECR  \n\n- **registry_url**: ECR  URL\n- **username**:  \n- **password**:\
        \  \n- **tag**:  \n- **app_dir**:"
      operationId: push_to_ecr_api_v1_push_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PushRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BuildResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/scaffold:
    post:
      tags:
      - Builds
      summary: Scaffold Spinapp
      description: "SpinApp  \n\n- **image_ref**:   (ECR URL:tag)\n- **component**:\
        \   ()\n- **replicas**:   (: 1)\n- **output_path**:    ()"
      operationId: scaffold_spinapp_api_v1_scaffold_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScaffoldRequest'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScaffoldResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/deploy:
    post:
      tags:
      - Builds
      summary: Deploy To K8S
      description: "K8s SpinApp \n\n- **namespace**: Kubernetes  ()\n- **image_ref**:\
        \   ()\n- **app_name**:   (, : Faker  )\n- **replicas**:   (: 1)\n- **enable_autoscaling**:\
        \ HPA/KEDA  (: true)\n- **use_spot**: Spot   (: true)"
      operationId: deploy_to_k8s_api_v1_deploy_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeployRequest'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeployResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/build-and-push:
    post:
      tags:
      - Builds
      summary: Build And Push
      description: '- **file**: .py   .zip  ()

        - **registry_url**: ECR  URL ()

        - **username**:   ()

        - **password**:   ()

        - **tag**:   (: sha256)

        - **app_name**:   ()'
      operationId: build_and_push_api_v1_build_and_push_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Body_build_and_push_api_v1_build_and_push_post'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BuildResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /:
    get:
      summary: Root
      description: ''
      operationId: root__get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
  /health:
    get:
      summary: Health
      description: ''
      operationId: health_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
components:
  schemas:
    Body_build_and_push_api_v1_build_and_push_post:
      properties:
        file:
          type: string
          format: binary
          title: File
        registry_url:
          type: string
          title: Registry Url
        username:
          type: string
          title: Username
        password:
          type: string
          title: Password
        tag:
          type: string
          title: Tag
          default: sha256
        app_name:
          anyOf:
          - type: string
          - type: 'null'
          title: App Name
        workspace_id:
          type: string
          title: Workspace Id
          default: ws-default
      type: object
      required:
      - file
      - registry_url
      - username
      - password
      title: Body_build_and_push_api_v1_build_and_push_post
    Body_build_api_v1_build_post:
      properties:
        file:
          type: string
          format: binary
          title: File
          description: .py   .zip
        app_name:
          anyOf:
          - type: string
          - type: 'null'
          title: App Name
          description: ''
        workspace_id:
          type: string
          title: Workspace Id
          description: ID
          default: ws-default
      type: object
      required:
      - file
      title: Body_build_api_v1_build_post
    BuildResponse:
      properties:
        task_id:
          type: string
          title: Task Id
          description: ID
        status:
          type: string
          title: Status
          description: ': pending|running|completed|failed'
        message:
          type: string
          title: Message
          description: ''
        source_s3_path:
          anyOf:
          - type: string
          - type: 'null'
          title: Source S3 Path
          description: S3
      type: object
      required:
      - task_id
      - status
      - message
      title: BuildResponse
      description: ''
    BuildTaskResult:
      properties:
        wasm_path:
          anyOf:
          - type: string
          - type: 'null'
          title: Wasm Path
          description: WASM
        image_url:
          anyOf:
          - type: string
          - type: 'null'
          title: Image Url
          description: ECR  URL
        file_path:
          anyOf:
          - type: string
          - type: 'null'
          title: File Path
          description: ''
      type: object
      title: BuildTaskResult
      description: ''
    DeployRequest:
      properties:
        app_name:
          anyOf:
          - type: string
          - type: 'null'
          title: App Name
          description: ''
        namespace:
          type: string
          title: Namespace
          description: Kubernetes
        service_account:
          anyOf:
          - type: string
          - type: 'null'
          title: Service Account
          description: ServiceAccount
        cpu_limit:
          anyOf:
          - type: string
          - type: 'null'
          title: Cpu Limit
          description: 'CPU  (: 500m)'
        memory_limit:
          anyOf:
          - type: string
          - type: 'null'
          title: Memory Limit
          description: '(: 128Mi)'
        cpu_request:
          anyOf:
          - type: string
          - type: 'null'
          title: Cpu Request
          description: 'CPU  (: 100m)'
        memory_request:
          anyOf:
          - type: string
          - type: 'null'
          title: Memory Request
          description: '(: 64Mi)'
        image_ref:
          type: string
          title: Image Ref
          description: (ECR URL:tag)
        enable_autoscaling:
          type: boolean
          title: Enable Autoscaling
          description: HPA/KEDA
          default: true
        replicas:
          type: integer
          minimum: 1.0
          title: Replicas
          description: ''
          default: 1
        use_spot:
          type: boolean
          title: Use Spot
          description: Spot
          default: true
        custom_tolerations:
          anyOf:
          - items:
              additionalProperties: true
              type: object
            type: array
          - type: 'null'
          title: Custom Tolerations
          description: tolerations
        custom_affinity:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
          title: Custom Affinity
          description: affinity
        function_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Function Id
          description: Function ID ( )
      type: object
      required:
      - namespace
      - image_ref
      title: DeployRequest
      description: K8s
    DeployResponse:
      properties:
        app_name:
          anyOf:
          - type: string
          - type: 'null'
          title: App Name
          description: SpinApp
        namespace:
          anyOf:
          - type: string
          - type: 'null'
          title: Namespace
          description: ''
        service_name:
          anyOf:
          - type: string
          - type: 'null'
          title: Service Name
          description: SpinApp   Service
        service_status:
          type: string
          title: Service Status
          description: 'Service : found|pending|not_found'
        endpoint:
          anyOf:
          - type: string
          - type: 'null'
          title: Endpoint
          description: Service
        enable_autoscaling:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Enable Autoscaling
          description: ''
        use_spot:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Use Spot
          description: Spot
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
          description: ''
      type: object
      required:
      - service_status
      title: DeployResponse
      description: K8s
    ExecutionLog:
      properties:
        id:
          type: string
          title: Id
        functionId:
          type: string
          title: Functionid
        timestamp:
          type: string
          format: date-time
          title: Timestamp
        status:
          type: string
          title: Status
        duration:
          type: number
          title: Duration
        statusCode:
          type: integer
          title: Statuscode
        requestBody:
          anyOf:
          - {}
          - type: 'null'
          title: Requestbody
        responseBody:
          anyOf:
          - {}
          - type: 'null'
          title: Responsebody
        logs:
          items:
            type: string
          type: array
          title: Logs
        level:
          type: string
          title: Level
          default: info
      type: object
      required:
      - id
      - functionId
      - timestamp
      - status
      - duration
      - statusCode
      title: ExecutionLog
      description: ''
    FunctionConfig:
      properties:
        id:
          type: string
          title: Id
        workspaceId:
          type: string
          title: Workspaceid
        name:
          type: string
          title: Name
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
        runtime:
          type: string
          title: Runtime
        memory:
          type: integer
          title: Memory
        timeout:
          type: integer
          title: Timeout
        httpMethods:
          items:
            type: string
          type: array
          title: Httpmethods
        environmentVariables:
          additionalProperties:
            type: string
          type: object
          title: Environmentvariables
        code:
          type: string
          title: Code
        invocationUrl:
          anyOf:
          - type: string
          - type: 'null'
          title: Invocationurl
        status:
          type: string
          title: Status
          default: active
        lastModified:
          type: string
          format: date-time
          title: Lastmodified
        lastDeployed:
          anyOf:
          - type: string
            format: date-time
          - type: 'null'
          title: Lastdeployed
        invocations24h:
          type: integer
          title: Invocations24H
          default: 0
        errors24h:
          type: integer
          title: Errors24H
          default: 0
        avgDuration:
          type: number
          title: Avgduration
          default: 0.0
      type: object
      required:
      - id
      - workspaceId
      - name
      - runtime
      - memory
      - timeout
      - httpMethods
      - environmentVariables
      - code
      - lastModified
      title: FunctionConfig
      description: ''
    FunctionCreate:
      properties:
        name:
          type: string
          minLength: 1
          title: Name
          description: ''
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
          description: ''
        runtime:
          type: string
          title: Runtime
          description: ''
          default: Python 3.12
        memory:
          type: integer
          maximum: 1024.0
          minimum: 128.0
          title: Memory
          description: (MB)
          default: 256
        timeout:
          type: integer
          maximum: 900.0
          minimum: 1.0
          title: Timeout
          description: ()
          default: 30
        httpMethods:
          items:
            type: string
          type: array
          title: Httpmethods
          description: HTTP
          default:
          - GET
        environmentVariables:
          additionalProperties:
            type: string
          type: object
          title: Environmentvariables
          description: ''
        code:
          type: string
          title: Code
          description: Base64  Python
      type: object
      required:
      - name
      - code
      title: FunctionCreate
      description: ''
    FunctionUpdate:
      properties:
        name:
          anyOf:
          - type: string
            minLength: 1
          - type: 'null'
          title: Name
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
        runtime:
          anyOf:
          - type: string
          - type: 'null'
          title: Runtime
        memory:
          anyOf:
          - type: integer
            maximum: 1024.0
            minimum: 128.0
          - type: 'null'
          title: Memory
        timeout:
          anyOf:
          - type: integer
            maximum: 900.0
            minimum: 1.0
          - type: 'null'
          title: Timeout
        httpMethods:
          anyOf:
          - items:
              type: string
            type: array
          - type: 'null'
          title: Httpmethods
        environmentVariables:
          anyOf:
          - additionalProperties:
              type: string
            type: object
          - type: 'null'
          title: Environmentvariables
        code:
          anyOf:
          - type: string
          - type: 'null'
          title: Code
        status:
          anyOf:
          - type: string
            pattern: ^(active|disabled)$
          - type: 'null'
          title: Status
      type: object
      title: FunctionUpdate
      description: ''
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    LogsResponse:
      properties:
        logs:
          items:
            $ref: '#/components/schemas/ExecutionLog'
          type: array
          title: Logs
        total:
          type: integer
          title: Total
      type: object
      required:
      - logs
      - total
      title: LogsResponse
      description: ''
    PushRequest:
      properties:
        registry_url:
          type: string
          title: Registry Url
          description: ECR  URL
        username:
          type: string
          title: Username
          description: ''
        password:
          type: string
          title: Password
          description: ''
        tag:
          type: string
          title: Tag
          description: ''
          default: sha256
        app_dir:
          anyOf:
          - type: string
          - type: 'null'
          title: App Dir
          description: ''
        workspace_id:
          type: string
          title: Workspace Id
          description: ID
        s3_source_path:
          anyOf:
          - type: string
          - type: 'null'
          title: S3 Source Path
          description: S3
      type: object
      required:
      - registry_url
      - username
      - password
      - workspace_id
      title: PushRequest
      description: ECR
    ScaffoldRequest:
      properties:
        image_ref:
          type: string
          title: Image Ref
          description: (ECR URL:tag)
        component:
          anyOf:
          - type: string
          - type: 'null'
          title: Component
          description: ''
        replicas:
          type: integer
          minimum: 1.0
          title: Replicas
          description: ''
          default: 1
        output_path:
          anyOf:
          - type: string
          - type: 'null'
          title: Output Path
          description: ''
      type: object
      required:
      - image_ref
      title: ScaffoldRequest
      description: SpinApp
    ScaffoldResponse:
      properties:
        success:
          type: boolean
          title: Success
          description: ''
        yaml_content:
          anyOf:
          - type: string
          - type: 'null'
          title: Yaml Content
          description: YAML
        file_path:
          anyOf:
          - type: string
          - type: 'null'
          title: File Path
          description: ''
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
          description: ''
      type: object
      required:
      - success
      title: ScaffoldResponse
      description: SpinApp
    TaskStatusResponse:
      properties:
        task_id:
          type: string
          title: Task Id
          description: ID
        status:
          type: string
          title: Status
          description: ': pending|running|completed|failed'
        result:
          anyOf:
          - $ref: '#/components/schemas/BuildTaskResult'
          - type: 'null'
          description: ''
        error:
          anyOf:
          - type: string
          - type: 'null'
          title: Error
          description: ''
      type: object
      required:
      - task_id
      - status
      title: TaskStatusResponse
      description: ''
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
    Workspace:
      properties:
        id:
          type: string
          title: Id
        name:
          type: string
          title: Name
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
        createdAt:
          type: string
          format: date-time
          title: Createdat
        functionCount:
          type: integer
          title: Functioncount
          default: 0
        invocations24h:
          type: integer
          title: Invocations24H
          default: 0
        errorRate:
          type: number
          title: Errorrate
          default: 0.0
      type: object
      required:
      - id
      - name
      - createdAt
      title: Workspace
      description: ''
    WorkspaceCreate:
      properties:
        name:
          type: string
          minLength: 1
          title: Name
          description: ''
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
          description: ''
      type: object
      required:
      - name
      title: WorkspaceCreate
      description: ''
    WorkspaceUpdate:
      properties:
        name:
          anyOf:
          - type: string
            minLength: 1
          - type: 'null'
          title: Name
          description: ''
        description:
          anyOf:
          - type: string
          - type: 'null'
          title: Description
          description: ''
      type: object
      title: WorkspaceUpdate
      description: ''
